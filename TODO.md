 1 # 프로젝트 할 일 목록 (TODO List)
    2
    3 이 목록은 `PLAN.md`의 개발 단계를 기반으로 작성되었습니다.
    4
    5 ## 1단계: 환경 설정
    6 - [x] Google AI Studio에서 Gemini API 키 발급받기
    7 - [ ] Python 및 Node.js 개발 환경 구축
    8 - [x] `chatbot-girlfriend` 프로젝트 폴더 생성
    9 - [x] `backend` 폴더 생성 및 `requirements.txt` 파일에 의존성 추가 (`fastapi`, `uvicorn`,
      `python-dotenv`, `google-generativeai`, `sqlalchemy`)
   10 - [x] `frontend` 폴더 생성 및 `create-react-app`으로 리액트 프로젝트 초기화
   11
   12 ## 2단계: 백엔드 개발
   13 - [x] FastAPI 기본 설정 및 `/chat` API 엔드포인트 생성
   14 - [x] Gemini API 연동 로직 구현 (사용자 메시지 + 대화 기록 + 페르소나)
   15 - [x] SQLAlchemy를 사용하여 SQLite 데이터베이스 설정
   16 - [x] 대화 기록 저장 및 조회 로직 구현
   17
   18 ## 3단계: 프론트엔드 개발
   19 - [x] 채팅 UI 컴포넌트 구현 (메시지 입력창, 대화창)
   20 - [x] 백엔드 `/chat` API와 연동하여 메시지 전송 기능 구현
   21 - [x] 챗봇 답변을 받아 화면에 표시하는 기능 구현
   22
   23 ## 4단계: 통합 및 테스트
   24 - [x] 백엔드와 프론트엔드 동시 실행 및 전체 기능 테스트
   25 - [x] 대화 내용이 올바르게 저장되고 다음 대화에 참고되는지 확인
   26 - [x] 정의된 페르소나가 챗봇 답변에 잘 반영되는지 확인
   27
   28 ## 5단계: 고도화 및 배포
   29 - [x] 페르소나 프롬프트 수정 및 개선
   30 - [x] 로딩 표시, 에러 메시지 등 사용자 경험 개선
   31 - [x] **캐릭터 교체**: 다솜 → 와구리 카오루코로 변경
- [x] **캐릭터 이미지 통합**: 대화창과 프로필에 캐릭터 이미지 표시
- [x] **사용자 이름 시스템**: 대화 시작 전 이름 입력 및 개인화
- [x] **대화 종료 기능**: 세션 리셋 버튼 추가
- [x] **한글 UI**: 모든 인터페이스 한글화
- [x] **자동화 스크립트**: 원클릭 실행 배치 파일 생성 (`카오루코_실행.bat`)
- [x] **데이터베이스 관리**: DB 확인 및 관리 도구 구현 (`DB_확인.bat`)
- [x] **최신 AI 모델**: Gemini 2.5 Flash 적용
- [x] **메모리 시스템**: 대화 맥락 유지 (최근 5개 대화)
- [x] **사용자별 기록**: user_name 기반 개인화된 대화 기록
- [x] **한글 인코딩**: UTF-8 지원으로 한글 문제 완전 해결
- [ ] (선택 사항) Vercel, Netlify 등 클라우드 플랫폼에 프로젝트 배포

## 🎭 **6단계: 고급 시스템 개발 (완료)**
- [x] **감정 분석 시스템 설계**
  - 6가지 핵심 감정 정의: 수줍음😊, 기쁨😄, 슬픔😢, 화남😠, 놀람😲, 설렘💕
  - Gemini API를 활용한 실시간 감정 분석 로직 설계
  - 감정 강도(1-10) 및 지속성 알고리즘 구현
- [x] **양방향 호감도 시스템**
  - -100 ~ +100 범위의 동적 호감도 변화
  - 7단계 관계 발전: 멀어진사람 ↔ 낯선사람 → 지인 → 친구 → 친한친구 → 절친 → 연인
  - 양수/음수별 차별화된 UI (💖/💔 하트, 양방향 게이지)
- [x] **미연시 이벤트 시스템**
  - 호감도 이정표별 특별 이벤트 (10→25→50→75→90점)
  - 관계 단계 승급 축하 시스템
  - 특별 대화 및 기념일 관리
- [x] **속마음 표현 시스템**
  - `*내용*` 패턴 자동 감지 및 파싱
  - 괄호 표시와 투명도로 시각적 구분
  - 자연스러운 내면 감정 표현

- [ ] **백엔드 감정 분석 엔진**
  - `emotion_system/emotion_analyzer.py` 새로 생성
  - EmotionAnalyzer 클래스: 대화 내용 → 감정 분석
  - 감정 히스토리 저장 및 감정 변화 추적 로직
  - `/chat` API에 감정 정보 포함하여 응답

- [ ] **프론트엔드 감정 표시 UI**
  - 실시간 감정 표시 컴포넌트 (헤더에 추가)
  - 감정별 이모티콘 + 애니메이션 효과
  - 감정 변화 시 부드러운 트랜지션 효과
  - 감정 강도에 따른 크기/색상 변화

## 🔊 **7단계: TTS (음성 출력) 시스템 (진행중)**

### 📋 **TTS 시스템 상세 설계 계획**

#### **A. 기술 스택 선택 및 아키텍처**
- [ ] **Web Speech API 분석**
  - ✅ 장점: 브라우저 내장, 추가 설치 불필요, 빠른 응답속도
  - ❌ 단점: 브라우저별 음성 차이, 제한적 커스터마이징
  - 🔍 지원 브라우저: Chrome(우수), Firefox(제한적), Safari(기본)

- [ ] **카오루코 음성 특성 정의**
  - 🎭 기본 특성: 여성 음성, 부드럽고 수줍은 톤
  - 📊 기본 파라미터: rate=0.8 (약간 느림), pitch=1.1 (약간 높음), volume=0.8
  - 🎯 목표: 17세 고등학생 단데레 캐릭터에 맞는 음성

#### **B. 감정별 TTS 매핑 시스템**
- [ ] **감정-음성 파라미터 테이블 설계**
```javascript
EMOTION_VOICE_MAP = {
  "수줍음": { rate: 0.7, pitch: 1.0, volume: 0.6, voice: "female_soft" },
  "기쁨":   { rate: 1.1, pitch: 1.3, volume: 0.9, voice: "female_bright" },
  "슬픔":   { rate: 0.6, pitch: 0.8, volume: 0.5, voice: "female_low" },
  "화남":   { rate: 1.2, pitch: 1.1, volume: 0.9, voice: "female_strong" },
  "놀람":   { rate: 1.3, pitch: 1.4, volume: 0.8, voice: "female_high" },
  "설렘":   { rate: 0.9, pitch: 1.2, volume: 0.7, voice: "female_warm" }
}
```

#### **C. 백엔드 TTS 처리 시스템**
- [ ] **텍스트 전처리 모듈**
  - 이모티콘 제거/변환 (😊 → "미소", 💕 → "하트")
  - 특수 문자 처리 (...→쉼, !→느낌표)
  - 한글 발음 최적화 (띄어쓰기, 문장부호)

- [ ] **TTS API 엔드포인트 설계**
```python
POST /tts/synthesize
{
  "text": "안녕하세요...",
  "emotion": "수줍음",
  "intensity": 7,
  "user_settings": {
    "auto_play": true,
    "speed_modifier": 1.0
  }
}
```

#### **D. 프론트엔드 TTS UI/UX**
- [ ] **메시지별 음성 재생 버튼**
  - 🔊 각 봇 메시지에 작은 재생 버튼 추가
  - 🎵 재생 중 상태 표시 (파동 애니메이션)
  - ⏸️ 일시정지/재개 기능

- [ ] **TTS 설정 패널**
```jsx
// TTS 설정 UI 구조
<TTSSettingsPanel>
  <AutoPlayToggle />           // 자동 재생 on/off
  <SpeedSlider min={0.5} max={2.0} />   // 속도 조절
  <VolumeSlider min={0} max={1} />      // 음량 조절  
  <VoiceSelector />            // 음성 선택 (가능한 경우)
  <TestButton />               // 테스트 재생
</TTSSettingsPanel>
```

#### **E. 감정-TTS 연동 세부사항**
- [ ] **감정별 음성 특성 구현**
  - 👤 **수줍음**: `rate: 0.7, pitch: 1.0, volume: 0.6` + 잦은 쉼
  - 😄 **기쁨**: `rate: 1.1, pitch: 1.3, volume: 0.9` + 밝은 톤
  - 😢 **슬픔**: `rate: 0.6, pitch: 0.8, volume: 0.5` + 낮은 톤
  - 😠 **화남**: `rate: 1.2, pitch: 1.1, volume: 0.9` + 강한 억양
  - 😲 **놀람**: `rate: 1.3, pitch: 1.4, volume: 0.8` + 높은 톤
  - 💕 **설렘**: `rate: 0.9, pitch: 1.2, volume: 0.7` + 부드러운 톤

#### **F. 구현 우선순위**
1. 🥇 **1순위**: Web Speech API 기본 TTS 구현
2. 🥈 **2순위**: 감정별 파라미터 조절 시스템
3. 🥉 **3순위**: 사용자 설정 UI (속도, 자동재생 등)
4. 🏅 **4순위**: 텍스트 전처리 및 발음 최적화

#### **G. 기술적 고려사항**
- [ ] **브라우저 호환성**: speechSynthesis API 지원 확인
- [ ] **성능 최적화**: 긴 텍스트 청킹, 메모리 관리
- [ ] **오류 처리**: 음성 로딩 실패, 권한 거부 대응
- [ ] **사용자 경험**: 로딩 상태, 재생 진행률 표시

## 🧪 **8단계: 통합 테스트 및 최적화**
- [ ] **감정 시스템 정확도 테스트**
  - 다양한 대화 시나리오로 감정 분석 정확도 검증
  - 감정 전환의 자연스러움 테스트
  - 사용자 피드백 기반 감정 매핑 조정

- [ ] **TTS 품질 및 성능 테스트**
  - 다양한 브라우저에서 음성 재생 테스트
  - 긴 텍스트 처리 성능 최적화
  - 네트워크 지연 시 사용자 경험 개선

- [ ] **통합 시스템 안정성**
  - 감정-TTS 동기화 테스트
  - 메모리 누수 및 성능 병목 지점 해결
  - 에러 핸들링 강화 (API 실패, 네트워크 문제 등)

## 🎯 **프로젝트 완성도: 99% (미연시 기능 완전 구현)**

### ✅ **현재 완료된 모든 기능들**:
- 🤖 **AI 기반**: Google Gemini 2.5 Flash (최신 모델)
- 🌸 **캐릭터**: 와구리 카오루코 (원작 완벽 재현 페르소나)
- 💬 **대화 시스템**: 지능형 메모리 기반 맥락 이해  
- 🎭 **감정 시스템**: 6가지 감정 실시간 분석 및 시각화
- 💕 **양방향 호감도**: -100~+100 범위, 7단계 관계 발전
- � **미연시 이벤트**: 호감도 이정표별 특별 이벤트
- 💭 **속마음 표현**: 자연스러운 내면 감정 시각화
- 💔 **관계 악화**: 음수 호감도, 깨진 하트, 역방향 게이지
- �🎨 **동적 UI**: 감정/관계별 실시간 색상/애니메이션 변화
- 🔧 **개발 도구**: 완벽한 개발자/사용자 편의 도구
- 📱 **사용성**: 원클릭 실행 및 데이터베이스 관리

### 🚀 **사용 방법**:
1. `카오루코_실행.bat` 더블클릭
2. 웹브라우저에서 이름 입력  
3. 와구리 카오루코와 대화 시작!
4. `DB_확인.bat`으로 대화 기록 확인 가능